# アセットフィールド

アセットフィールドでは、関連する[アセット](assets.md)を選択できます。

## 設定

アセットフィールドの設定は、次の通りです。

* **アップロードを単一のフォルダに限定しますか？** – ファイルのアップロード・選択を単一のフォルダに制限するかどうか
* **ソース** – ファイルの選択・アップロードを可能とするアセットボリューム
* **既定のアップロードロケーション** – フィールドに直接ドラッグされたファイルを保存するデフォルトのロケーション
* **許可されるファイルの種類を制限しますか？** 特定の種類のファイルだけを選択・アップロードできるフィールドにするかどうか
* **ターゲットロケール** – 関連付けするアセットのロケール（この設定は複数のサイトロケールを持つ Craft Pro が実行されている場合のみ、表示されます）
* **リミット** – フィールドに関連付けできるアセット数の上限（デフォルトは無制限です）
* **選択ラベル** – フィールドの選択ボタンのラベルに使用されます

### アップロードを単一のフォルダに限定

「アップロードを単一のフォルダに制限しますか？」がオンの場合、「ソース」と「既定のアップロードロケーション」は「ロケーションをアップロードする」に置き換えられます。

### 許可されるファイルの種類を制限

「許可されるファイルの種類を制限しますか？」がオンの場合、その下にファイルの種類の一覧が表示されます。

### 動的なサブフォルダパス

「既定のアップロードロケーション」と「アップロードを単一のフォルダに制限しますか？」をオンにしたときに置き換えられる「ロケーションをアップロードする」は、動的なサブフォルダパスをサポートしています。

エレメントが保存されると、サブフォルダパスはソースエレメントのプロパティに相当するタグで解析されます。例えば、[エントリ](sections-and-entries.md)フィールドを利用したい場合、`{id}` や `{slug}`、または `{author.username}` のようなネストされたオブジェクトのプロパティなど、 <api:craft\elements\entries> ドキュメントに記載されているすべてのプロパティを利用できます。

通常の Twig タグもサポートされています。パスに条件文 `{% if %}` を含めたり、`{{ now|date('Y-m-d') }}` や `{{ currentUser.username }}` のようなソースエレメント以外のオブジェクトにもアクセスできます。

通常の Twig タグでは、 変数「object」を使用してソースエレメントにアクセスできます。例えば、これはソースエレメントにスラグがあればそれを、そうでなければ ID を出力することができます。

```twig
{{ object.slug ?: object.id }}
```

[行列フィールド](matrix-fields.md)の中でアセットフィールドを作成する場合、ソースエレメントは作成された行列フィールドのエレメント _ではなく_、実際の行列ブロックになります。そのため、行列フィールドがエントリに紐づけられていて、動的なサブフォルダパスにエントリ ID を出力したい場合、`{id}` ではなく `{owner.id}` と記述します。

## フィールド

アセットフィールドには、現在選択されているすべてのアセットのリストと、新しいアセットを追加するためのボタンがあります。

「アセットを追加」ボタンをクリックすると、新しいアセットのアップロードはもちろん、すでに追加されているアセットの検索や選択ができるモーダルウィンドウが表示されます。

### アセットコンテンツの編集

選択されたアセットをダブルクリックすると、ファイルのタイトルや「設定 > アセット > フィールド」でアセットに関連付けられたフィールドを編集できるモーダルウィンドウが開きます。

## テンプレート記法

テンプレート内でアセットフィールドのエレメントを取得する場合、アセットフィールドのハンドルを利用して、選択されたアセットにアクセスできます。

```twig
{% set assets = entry.assetsFieldHandle %}
```

これは、所定のフィールドで選択されたすべてのアセットを出力するよう準備された[エレメントクエリ](element-queries.md)を提供します。言い換えれば、上の行は次のコードのショートカットとなります。

```twig
{% set assets = craft.assets({
 relatedTo: { sourceElement: entry, field: "assetsFieldHandle" },
 order:"sortOrder",
 limit:null
}) %}
```

（`relatedTo` パラメータの詳細は、[リレーション](relations.md)を見てください。）

### 実例

アセットフィールドに選択されたアセットがあるかどうかを調べるには、`length` フィルタを利用します。

```twig
{% if entry.assetsFieldHandle|length %}
 {% for asset in entry.assetsFieldHandle %}
 {{ asset.url }}
 {% endfor %}
{% endif %}
```

選択されたアセットをループするには、フィールドを配列のように扱います。

```twig
{% for asset in entry.assetsFieldHandle %}
 {{ asset.url }}
{% endfor %}
```

常に「`entry.assetsFieldHandle`」を記述するよりもむしろ、一度呼び出して別の変数にセットしましょう。

```twig
{% set assets = entry.assetsFieldHandle %}

{% if assets|length %}

 <h3>Some great assets</h3>
 {% for asset in assets %}
 {{ asset.url }}
 {% endfor %}

{% endif %}
```

ElementCriteriaModel オブジェクトにパラメータを追加することもできます。

```twig
{% set images = entry.assetsFieldHandle.kind('image') %}
```

意図的にアセットフィールドへ1つだけセットしている場合でも、アセットフィールドを呼び出すと、選択されたアセットではなく、同じ ElementCriteriaModel として提供されることを覚えておいてください。選択された最初の（1つだけの）アセットを取得するには、`one()` を利用します。

```twig
{% set asset = entry.myAssetsField.one() %}

{% if asset %}
 {{ asset.url }}
{% endif %}
```

### フロントエンドフォームからのファイルアップロード

フロントエンドの[エントリフォーム](templating/examples/entry-form.md)から、アセットフィールドへのファイルアップロードをユーザーに許可するには、2つの調整が必要です。

まず、`<form>` タグに `enctype="multipart/form-data"` 属性があることを確認して、ファイルをアップロードできるようにします。

* プレーンテキストフィールドにテキストエリアを追加するのと同じ方法で、フォームにファイル入力欄を追加します。

```markup
<input type="file" name="fields[assetsFieldHandle]">
```

一度に複数ファイルをアップロードできるようにするには、`multiple` 属性を追加し、input 名の最後が `[]` であることを確認します。

```markup
<input type="file" name="fields[assetsFieldHandle][]" multiple>
```

## 関連項目

* [エレメントクエリ](element-queries.md)
* [アセットのクエリパラメータ](element-query-params/asset-query-params.md)
* <api:craft\elements\Asset>
* [リレーション](relations.md)

